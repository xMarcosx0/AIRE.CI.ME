<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>
    <link rel="icon" type="image/png" href="../Images/IconoAir-e.webp">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet.hexbin -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/d3-hexbin@0.2.2"></script>
    <script src="https://unpkg.com/leaflet-d3@0.4.0"></script>
    <link href="../Css/admin.css" rel="stylesheet">
    <!-- Para los graficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#users" data-bs-toggle="tab">
                                <i class="fas fa-users me-2"></i>Usuarios
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#projects" data-bs-toggle="tab">
                                <i class="fas fa-project-diagram me-2"></i>Proyectos
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#map" data-bs-toggle="tab">
                                <i class="fas fa-map-marked-alt me-2"></i>Mapa
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="fas fa-cog me-2"></i>Configuración
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Navbar -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Panel de Administración</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        
                        
<div class="dropdown">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="fas fa-bell"></i>
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none" id="notification-badge">
        0
      </span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end notifications-dropdown" aria-labelledby="notificationsDropdown">
      <li><h6 class="dropdown-header">Notificaciones</h6></li>
      <div id="notifications-list" class="px-0"></div>
      <li><hr class="dropdown-divider my-0"></li>
      <li><a class="dropdown-item text-center py-2 small" href="#" id="mark-all-read">Marcar todas como leídas</a></li>
    </ul>
  </div>
                        
                        <div class="dropdown ms-2">
                            <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center" type="button" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjZmZmZmZmIj48cGF0aCBkPSJNMTIgMEM1LjM3MyAwIDAgNS4zNzMgMCAxMnM1LjM3MyAxMiAxMiAxMiAxMi01LjM3MyAxMi0xMlMxOC42MjcgMCAxMiAwem0wIDVjMS42NTQgMCAzIDEuMzQ2IDMgM3MtMS4zNDYgMy0zIDMtMy0xLjM0Ni0zLTNzMS4zNDYtMyAzLTN6bTAgMTMuNWMtMi43MzkgMC01LjIxMy0xLjE5LTYuOTQ1LTMuMTk0QzUuNDEgMTMuNjEzIDguNTA0IDEzIDEyIDEzYzMuNDk2IDAgNi41OS42MTMgOC45NDUgMS44MDZDMTcuMjEzIDE3LjMxIDE0LjczOSAxOC41IDEyIDE4LjV6Ii8+PC9zdmc+" class="rounded-circle me-2" width="30" height="30">
                                <span id="user-name">Admin</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                                <li><a class="dropdown-item" href="#" id="profile-button"><i class="fas fa-user me-2"></i>Perfil</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logout-button" onclick="directLogout(); return false;"><i class="fas fa-sign-out-alt me-2"></i>Cerrar sesión</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div class="tab-pane fade show active" id="dashboard">
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card-counter primary" id="show-users-card">
                                    <i class="fas fa-users"></i>
                                    <span class="count-numbers" id="total-users">0</span>
                                    <span class="count-name">Usuarios</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-counter info" id="show-projects-card">
                                    <i class="fas fa-project-diagram"></i>
                                    <span class="count-numbers" id="total-projects">0</span>
                                    <span class="count-name">Proyectos</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-counter warning" id="show-in-progress-card">
                                    <i class="fas fa-tasks"></i>
                                    <span class="count-numbers" id="in-progress-projects">0</span>
                                    <span class="count-name">En gestión</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card-counter success" id="show-completed-card">
                                    <i class="fas fa-check-circle"></i>
                                    <span class="count-numbers" id="completed-projects">0</span>
                                    <span class="count-name">Finalizados</span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Proyectos por Estado</h5>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn active" data-period="month">Mensual</button>
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn" data-period="year">Anual</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="projects-by-status-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Proyectos por Departamento</h5>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" id="refresh-department-chart">
                                                <i class="fas fa-sync-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="projects-by-department-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Flujo de Proyectos</h5>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn active" data-period="day">Diario</button>
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn" data-period="month">Mensual</button>
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn" data-period="year">Anual</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="projects-flow-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Proyectos por PRST</h5>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn active" data-period="month" data-chart="prst">Mensual</button>
                                                <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn" data-period="year" data-chart="prst">Anual</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="projects-by-prst-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                              <div class="card mb-12">
                                <div class="card-header">
                                  <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Proyectos por Tipo de Solicitud</h5>
                                    <div class="btn-group">
                                      <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn active" data-period="month" data-chart="request-type">Mensual</button>
                                      <button type="button" class="btn btn-sm btn-outline-secondary time-period-btn" data-period="year" data-chart="request-type">Anual</button>
                                    </div>
                                  </div>
                                </div>
                                <div class="card-body">
                                  <div class="chart-container">
                                    <!-- AQUÍ VA EL CANVAS FALTANTE -->
                                    <canvas id="projects-by-request-type-chart"></canvas>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        
                        
                    </div>

                    <!-- Users Tab -->
                    <div class="tab-pane fade" id="users">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                            <h2 class="h2">Gestión de Usuarios</h2>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button class="btn btn-primary" id="new-user-button">
                                    <i class="fas fa-plus me-1"></i> Nuevo Usuario
                                </button>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Usuario</th>
                                        <th>Correo</th>
                                        <th>Rol</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                        <div class="row">
                                            
                                        </div>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <tr>
                                        <td colspan="7" class="text-center">Cargando usuarios...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Projects Tab -->
                    <div class="tab-pane fade" id="projects">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                            <h2 class="h2">Gestión de Proyectos</h2>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button class="btn btn-primary" id="create-project-button">
                                    <i class="fas fa-plus me-1"></i> Crear Proyecto
                                </button>
                                <button class="btn btn-primary" id="filter-projects-button" data-bs-toggle="collapse" data-bs-target="#filters-collapse">
                                    <i class="fas fa-filter me-1"></i> Filtros
                                </button>
                                <button class="btn btn-outline-secondary ms-2" id="clear-highlight-button" style="display: none;">
                                    <i class="fas fa-times me-1"></i> Limpiar selección
                                </button>
                            </div>
                            
                        </div>

                        <div class="collapse mb-3" id="filters-collapse">
                            <div class="card card-body">
                                <form id="filter-form">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="filter-date-type" class="form-label">Tipo de Fecha</label>
                                                <select class="form-select" id="filter-date-type">
                                                    <option value="creacion">Creación</option>
                                                    <option value="inicio">Inicio</option>
                                                    <option value="fin">Finalización</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="filter-date-from" class="form-label">Desde</label>
                                                <select class="form-select" id="filter-date-from">
                                                    <option value="">Seleccione fecha</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="filter-date-to" class="form-label">Hasta</label>
                                                <select class="form-select" id="filter-date-to">
                                                    <option value="">Seleccione fecha</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="filter-status" class="form-label">Estado</label>
                                                <select class="form-select" id="filter-status">
                                                    <option value="">Todos</option>
                                                    <option value="Nuevo">Nuevo</option>
                                                    <option value="En Proceso de Viabilidad">En Proceso de Viabilidad</option>
                                                    <option value="En Gestión">En Gestión</option>
                                                    <option value="Finalizado">Finalizado</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="filter-prst" class="form-label">PRST</label>
                                                <select class="form-select" id="filter-prst">
                                                    <option value="">Todos</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="filter-department" class="form-label">Departamento</label>
                                                <select class="form-select" id="filter-department">
                                                    <option value="">Todos</option>
                                                    <option value="Atlántico">Atlántico</option>
                                                    <option value="La Guajira">La Guajira</option>
                                                    <option value="Magdalena">Magdalena</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="mb-4">
                                                    <label for="filter-request-type" class="form-label">Tipo de Solicitud</label>
                                                    <select class="form-select" id="filter-request-type">
                                                        <option value="">Todos</option>
                                                        <option value="SEV">Solicitud de Estudio de Viabilidad (SEV)</option>
                                                        <option value="SDR">Solicitud de Desmonte de Redes (SDR)</option>
                                                        <option value="SIPRST">Solicitud de Intervenciones PRST (SIPRST)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>    
                                    </div>
                                    <div class="text-end">
                                        <button type="button" class="btn btn-primary" id="apply-filters">Aplicar Filtros</button>
                                        <button type="reset" class="btn btn-outline-secondary">Limpiar</button>
                                    </div>
                                    
                                </form>
                            </div>
                        </div>
                        

                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>OT AIR-E</th>
                                        <th>Nombre</th>
                                        <th>PRST</th>
                                        <th>Departamento</th>
                                        <th>Fecha Creación</th>
                                        <th>Fecha Inicio</th>
                                        <th>Fecha Fin</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="projects-table-body">
                                    <tr>
                                        <td colspan="9" class="text-center">Cargando proyectos...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    
                    <!-- Map Tab -->
                    <div class="tab-pane fade" id="map">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                            <h2 class="h2">Mapa de Proyectos</h2>
                        </div>
                        <div id="projects-map" style="height: 600px; width: 100%;"></div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-pane fade" id="settings">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
                            <h2 class="h2">Configuración del Sistema</h2>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Roles y Permisos</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Configuración de roles y permisos del sistema.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Configuración General</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>Configuración general del sistema.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <!-- Dentro del main, después del div.tab-content -->
<div id="profile-section" class="d-none">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Perfil de Usuario</h1>
        <button class="btn btn-outline-secondary" id="back-to-dashboard">
            <i class="fas fa-arrow-left me-1"></i> Volver al Dashboard
        </button>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Información Básica</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Nombre</label>
                        <p id="profile-nombre" class="form-control-plaintext ps-2"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Apellido</label>
                        <p id="profile-apellido" class="form-control-plaintext ps-2"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Usuario</label>
                        <p id="profile-usuario" class="form-control-plaintext ps-2"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Correo Electrónico</label>
                        <p id="profile-correo" class="form-control-plaintext ps-2"></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Rol</label>
                        <p id="profile-rol" class="form-control-plaintext ps-2"></p>
                    </div>
                </div>
            </div>
        </div>
       
    </div>
</div>
            </main>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="user-title">Nuevo Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="user-form">
                    <div class="modal-body">
                        <input type="hidden" id="user-id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="user-nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="user-nombre" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="user-apellido" class="form-label">Apellido</label>
                                    <input type="text" class="form-control" id="user-apellido" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="user-usuario" class="form-label">Usuario</label>
                                    <input type="text" class="form-control" id="user-usuario" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="user-email" class="form-label">Correo Electrónico</label>
                                    <input type="email" class="form-control" id="user-email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="user-rol" class="form-label">Rol</label>
                                    <select class="form-select" id="user-rol" required>
                                        <option value="admin">Administrador</option>
                                        <option value="ejecutiva">Ejecutiva</option>
                                        <option value="coordinador">Coordinador</option>
                                        <option value="analista">Analista</option>
                                        <option value="brigada">Brigada</option>
                                        <option value="prst">PRST</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="user-activo-text" class="form-label">Estado</label>
                                    <input type="text" class="form-control" id="user-activo-text" value="Activo" readonly>
                                    <input type="hidden" id="user-activo" value="true">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="user-password" class="form-label">Contraseña</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="user-password" required>
                                <button class="btn btn-outline-secondary" type="button" id="toggle-password">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Campos específicos para PRST -->
                        <div id="prst-fields" class="d-none">
                            <hr>
                            <h5>Información de PRST</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="user-prst-nombre" class="form-label">Nombre del PRST</label>
                                        <input type="text" class="form-control" id="user-prst-nombre">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="user-cedula" class="form-label">Cédula</label>
                                        <input type="text" class="form-control" id="user-cedula">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="user-matricula" class="form-label">Matrícula Profesional</label>
                                        <input type="text" class="form-control" id="user-matricula">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="user-celular" class="form-label">Celular</label>
                                        <input type="text" class="form-control" id="user-celular">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="user-direccion" class="form-label">Dirección</label>
                                        <input type="text" class="form-control" id="user-direccion">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="user-barrio" class="form-label">Barrio</label>
                                        <input type="text" class="form-control" id="user-barrio">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="user-ciudad" class="form-label">Ciudad</label>
                                <input type="text" class="form-control" id="user-ciudad">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-warning" id="toggle-user-status-btn">
                            <span id="toggle-status-text">Desactivar Usuario</span>
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="save-user-button">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para crear proyecto -->
<div class="modal fade" id="createProjectModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Crear Nuevo Proyecto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="project-form">
                <input type="hidden" id="project-id">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-kmz" class="form-label">Archivo KMZ*</label>
                                <input type="file" class="form-control" id="project-kmz" accept=".kmz" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-name" class="form-label">Nombre del Proyecto*</label>
                                <input type="text" class="form-control" id="project-name" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-prst" class="form-label">PRST*</label>
                                <select class="form-select" id="project-prst" required>
                                    <option value="">Seleccione un PRST</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-ot" class="form-label">OT AIR-E</label>
                                <input type="text" class="form-control" id="project-ot" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-ot-prst" class="form-label">OT PRST (Opcional)</label>
                                <input type="text" class="form-control" id="project-ot-prst">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-department" class="form-label">Departamento*</label>
                                <select class="form-select" id="project-department" required>
                                    <option value="">Seleccione un departamento</option>
                                    <option value="Atlántico">Atlántico</option>
                                    <option value="La Guajira">La Guajira</option>
                                    <option value="Magdalena">Magdalena</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-municipality" class="form-label">Municipio*</label>
                                <select class="form-select" id="project-municipality" required>
                                    <option value="">Seleccione un municipio</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="project-neighborhood" class="form-label">Barrio*</label>
                                <input type="text" class="form-control" id="project-neighborhood" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="project-poles" class="form-label">Número de postes*</label>
                                <input type="number" class="form-control" id="project-poles" min="1" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección de distribución de alturas (inicialmente oculta) -->
                    <div id="pole-heights-container" class="d-none mb-3">
                        <label class="form-label">Distribución por altura (metros)</label>
                        <div class="row g-2">
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="8" placeholder="0" min="0">
                                    <span class="input-group-text">8m</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="9" placeholder="0" min="0">
                                    <span class="input-group-text">9m</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="10" placeholder="0" min="0">
                                    <span class="input-group-text">10m</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="11" placeholder="0" min="0">
                                    <span class="input-group-text">11m</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="12" placeholder="0" min="0">
                                    <span class="input-group-text">12m</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="14" placeholder="0" min="0">
                                    <span class="input-group-text">14m</span>
                                </div>
                            </div>
                            <div class="col-6 col-md-4 col-lg-3">
                                <div class="input-group mb-2">
                                    <input type="number" class="form-control pole-height" data-height="16" placeholder="0" min="0">
                                    <span class="input-group-text">16m</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-muted small" id="height-summary">Total: 0 de 0 postes</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="project-observations" class="form-label">Observaciones</label>
                        <textarea class="form-control" id="project-observations" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="save-project-button">Guardar Proyecto</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Modal para ver detalles del proyecto -->
  <!-- Modal para ver detalles del proyecto -->
<div class="modal fade" id="modalDetalleProyecto" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Detalles del Proyecto <span id="detalleProyectoIdBadge" class="badge bg-secondary ms-2"></span></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Columna izquierda - Información básica -->
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Información Básica</h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-borderless">
                                    <tr>
                                        <th class="w-40">ID:</th>
                                        <td id="detalleProyectoId"></td>
                                    </tr>
                                    <tr>
                                        <th>OT AIR-E:</th>
                                        <td id="detalleProyectoOtAirE"></td>
                                    </tr>
                                    <tr>
                                        <th>OT PRST:</th>
                                        <td id="detalleProyectoOtPrst"></td>
                                    </tr>
                                    <tr>
                                        <th>Nombre:</th>
                                        <td id="detalleProyectoNombre"></td>
                                    </tr>
                                    <tr>
                                        <th>PRST:</th>
                                        <td id="detalleProyectoPrst"></td>
                                    </tr>
                                    <tr>
                                        <th>Tipo Solicitud:</th>
                                        <td id="detalleProyectoTipoSolicitud"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Ubicación</h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-borderless">
                                    <tr>
                                        <th class="w-40">Departamento:</th>
                                        <td id="detalleProyectoDepartamento"></td>
                                    </tr>
                                    <tr>
                                        <th>Municipio:</th>
                                        <td id="detalleProyectoMunicipio"></td>
                                    </tr>
                                    <tr>
                                        <th>Barrio(s):</th>
                                        <td id="detalleProyectoBarrios"></td>
                                    </tr>
                                    <tr>
                                        <th>Dirección Inicial:</th>
                                        <td id="detalleProyectoDireccionInicial"></td>
                                    </tr>
                                    <tr>
                                        <th>Dirección Final:</th>
                                        <td id="detalleProyectoDireccionFinal"></td>
                                    </tr>
                                    <tr>
                                        <th>Punto Conexión:</th>
                                        <td id="detalleProyectoPuntoConexion"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Columna derecha - Detalles técnicos y estado -->
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Detalles Técnicos</h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-borderless">
                                    <tr>
                                        <th class="w-40">N° Postes:</th>
                                        <td id="detalleProyectoNumPostes"></td>
                                    </tr>
                                    <tr>
                                        <th>Altura Postes:</th>
                                        <td id="detalleProyectoAlturaPostes"></td>
                                    </tr>
                                    <tr>
                                        <th>Estado Inicial:</th>
                                        <td id="detalleProyectoEstadoInicial"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Fechas Clave</h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-borderless">
                                    <tr>
                                        <th class="w-40">Creación:</th>
                                        <td id="detalleProyectoFechaCreacion"></td>
                                    </tr>
                                    <tr>
                                        <th>Inicio:</th>
                                        <td id="detalleProyectoFechaInicio"></td>
                                    </tr>
                                    <tr>
                                        <th>Finalización:</th>
                                        <td id="detalleProyectoFechaFin"></td>
                                    </tr>
                                    <tr>
                                        <th>Asignación:</th>
                                        <td id="detalleProyectoFechaAsignacion"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Estado Actual</h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-borderless">
                                    <tr>
                                        <th class="w-40">Estado:</th>
                                        <td id="detalleProyectoEstado"></td>
                                    </tr>
                                    <tr>
                                        <th>Asignado a:</th>
                                        <td id="detalleProyectoAsignadoA"></td>
                                    </tr>
                                    <tr>
                                        <th>Observaciones:</th>
                                        <td id="detalleProyectoObservaciones"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de distribución de postes por altura -->
                <div class="card mb-3">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">Distribución de Postes por Altura</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>8m</th>
                                            <th>9m</th>
                                            <th>10m</th>
                                            <th>11m</th>
                                            <th>12m</th>
                                            <th>14m</th>
                                            <th>16m</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td id="detalleProyectoAltura8">0</td>
                                            <td id="detalleProyectoAltura9">0</td>
                                            <td id="detalleProyectoAltura10">0</td>
                                            <td id="detalleProyectoAltura11">0</td>
                                            <td id="detalleProyectoAltura12">0</td>
                                            <td id="detalleProyectoAltura14">0</td>
                                            <td id="detalleProyectoAltura16">0</td>
                                            <td id="detalleProyectoTotalPostes">0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de documentos -->
                <div class="card">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">Documentación</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Tipo</th>
                                        <th>Documento</th>
                                        <th>Estado</th>
                                        <th>Última Actualización</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaDocumentosDetalle">
                                    <!-- Se llenará dinámicamente -->
                                    <tr>
                                        <td colspan="5" class="text-center">No hay documentos registrados</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btnImprimirDetalle">
                    <i class="fas fa-print me-1"></i> Imprimir
                </button>
            </div>
        </div>
    </div>
</div>

    <!-- Modal de Perfil -->
<!-- Modal de Perfil -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Perfil de Usuario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <p id="modal-profile-nombre" class="form-control-static"></p>
          </div>
          <div class="mb-3">
            <label class="form-label">Apellido</label>
            <p id="modal-profile-apellido" class="form-control-static"></p>
          </div>
          <div class="mb-3">
            <label class="form-label">Usuario</label>
            <p id="modal-profile-usuario" class="form-control-static"></p>
          </div>
          <div class="mb-3">
            <label class="form-label">Correo Electrónico</label>
            <p id="modal-profile-correo" class="form-control-static"></p>
          </div>
          <div class="mb-3">
            <label class="form-label">Rol</label>
            <p id="modal-profile-rol" class="form-control-static"></p>
          </div>
          <div class="mb-3">
            <label class="form-label">Estado</label>
            <p id="modal-profile-activo" class="form-control-static"></p>
          </div>
          <div class="mb-3">
            <label class="form-label" for="modal-profile-password">Contraseña</label>
            <div class="input-group">
              <input type="password" id="modal-profile-password" class="form-control" value="********" readonly>
              <button class="btn btn-outline-secondary" type="button" id="toggle-modal-password">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
          
          <!-- Agrega este modal después del modal de usuario en admin.html -->


          <!-- Campos específicos para PRST -->
          <div id="modal-prst-fields" class="d-none">
            <hr>
            <h5>Información de PRST</h5>
            <div class="mb-3">
              <label class="form-label">Nombre del PRST</label>
              <p id="modal-profile-prst-nombre" class="form-control-static"></p>
            </div>
            <div class="mb-3">
              <label class="form-label">Cédula</label>
              <p id="modal-profile-cedula" class="form-control-static"></p>
            </div>
            <div class="mb-3">
              <label class="form-label">Matrícula Profesional</label>
              <p id="modal-profile-matricula" class="form-control-static"></p>
            </div>
            <div class="mb-3">
              <label class="form-label">Celular</label>
              <p id="modal-profile-celular" class="form-control-static"></p>
            </div>
            <div class="mb-3">
              <label class="form-label">Dirección</label>
              <p id="modal-profile-direccion" class="form-control-static"></p>
            </div>
            <div class="mb-3">
              <label class="form-label">Barrio</label>
              <p id="modal-profile-barrio" class="form-control-static"></p>
            </div>
            <div class="mb-3">
              <label class="form-label">Ciudad</label>
              <p id="modal-profile-ciudad" class="form-control-static"></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cambiar Contraseña</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="change-password-form">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="current-password" class="form-label">Contraseña Actual</label>
                            <input type="password" class="form-control" id="current-password" required>
                        </div>
                        <div class="mb-3">
                            <label for="new-password" class="form-label">Nueva Contraseña</label>
                            <input type="password" class="form-control" id="new-password" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirm-password" class="form-label">Confirmar Nueva Contraseña</label>
                            <input type="password" class="form-control" id="confirm-password" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="save-password-btn">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Deactivate User Modal -->
    <div class="modal fade" id="deactivateUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Acción</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>¿Está seguro que desea <span id="action-text">desactivar</span> al usuario <strong id="user-to-deactivate">Nombre Apellido</strong>?</p>
                    <div class="mb-3">
                        <label for="deactivation-reason" class="form-label">Razón</label>
                        <textarea class="form-control" id="deactivation-reason" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirm-deactivate-btn">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div class="modal fade" id="modalDetalleProyecto" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Detalles del Proyecto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">ID del Proyecto</label>
                                <p id="detalleProyectoId" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <p id="detalleProyectoNombre" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">PRST</label>
                                <p id="detalleProyectoPrst" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Departamento</label>
                                <p id="detalleProyectoDepartamento" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Municipio</label>
                                <p id="detalleProyectoMunicipio" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Barrios</label>
                                <p id="detalleProyectoBarrios" class="form-control-static"></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Fecha de Creación</label>
                                <p id="detalleProyectoFechaCreacion" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Fecha de Inicio</label>
                                <p id="detalleProyectoFechaInicio" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Fecha de Finalización</label>
                                <p id="detalleProyectoFechaFin" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Estado</label>
                                <p id="detalleProyectoEstado" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Número de Postes</label>
                                <p id="detalleProyectoPostes" class="form-control-static"></p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tipo de Solicitud</label>
                                <p id="detalleProyectoTipoSolicitud" class="form-control-static"></p>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row mt-3">
                        <div class="col-12">
                          <div class="mb-3">
                            <label class="form-label fw-bold">Documentación</label>
                            <div id="detalleProyectoDocumentacion" class="form-control-plaintext ps-2"></div>
                          </div>
                        </div>
                      </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Project History Modal -->
    <div class="modal fade" id="projectHistoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Historial del Proyecto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Fecha y Hora</th>
                                    <th>OT AIR-E</th>
                                    <th>Estado</th>
                                    <th>Modificado por:</th>
                                    <th>Rol</th>
                                    <th>Descripción</th>
                                </tr>
                            </thead>
                            <tbody id="project-history-body">
                                <tr>
                                    <td colspan="6" class="text-center">Cargando historial...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Leaflet JS para mapas -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.hexbin@1.0.0/leaflet-hexbin.min.js"></script>

<!-- Tus scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../Js/storage.js"></script>
<script src="../Js/admin.js"></script>
</body>
</html>
